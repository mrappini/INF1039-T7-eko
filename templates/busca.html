<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca - Eko</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1E1E1E;
            color: #FFFFFF;
            padding: 1.5rem;
            min-height: 100vh;
        }
        .search-page-container { width: 100%; max-width: 600px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        .back-arrow { font-size: 1.5rem; color: #FFFFFF; text-decoration: none; line-height: 1; display: inline-block; }
        
        .search-bar { margin-bottom: 2rem; }
        .search-bar form { display: flex; gap: 10px; }
        .search-bar input {
            flex: 1; padding: 1rem 1.5rem; border: none; border-radius: 12px;
            background-color: #2F2F2F; color: #FFFFFF; font-size: 1rem;
        }
        .search-bar button {
            padding: 1rem 1.5rem; border: none; border-radius: 12px;
            background-color: #F76B1C; color: #FFFFFF; font-size: 1rem; cursor: pointer;
        }
        .search-bar input::placeholder { color: #A0A0A0; }
        .search-bar input:focus { outline: none; }

        .search-center-message { text-align: center; margin-bottom: 2rem; }
        .search-icon { font-size: 4rem; color: #555555; display: block; margin: 0 auto 0.5rem auto; }
        .search-center-message p { color: #B0B0B0; }
        .search-center-message .highlight-text { color: #F76B1C; }

        .popular-searches h2 { font-size: 0.9rem; font-weight: 500; color: #FFFFFF; margin-bottom: 1rem; text-transform: lowercase; }
        .popular-list { list-style: none; padding: 0; }
        .popular-list li { margin-bottom: 0.5rem; }
        .popular-list a {
            display: block; padding: 1rem 1.5rem; border-radius: 12px;
            background-color: #2F2F2F; color: #FFFFFF; text-decoration: none;
            font-size: 1rem; transition: background-color 0.2s ease;
        }
        .popular-list a:hover { background-color: #3A3A3A; }

        .search-results { margin-top: 2rem; }
        .album-result {
            background-color: #2F2F2F; border-radius: 12px; padding: 1rem;
            margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem;
            transition: transform 0.2s;
        }
        .album-result:hover { transform: scale(1.01); background-color: #3A3A3A; }
        .album-result img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }
        .album-info { flex: 1; }
        .album-info h3 { color: #FFFFFF; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .album-info p { color: #B0B0B0; margin-bottom: 0.25rem; font-size: 0.9rem; }
        .spotify-link { color: #1DB954; text-decoration: none; font-size: 0.8rem; display: inline-block; margin-top: 5px; }
        .error-message { color: #ff4444; text-align: center; padding: 1rem; background-color: #2F2F2F; border-radius: 12px; margin-top: 1rem; }
    </style>
</head>
<body>

    <div class="search-page-container">
        <header>
            <a href="/" class="back-arrow">&larr;</a>
        </header>

        <div class="search-bar">
            <form id="buscaForm">
                <input type="text" id="searchInput" name="query" placeholder="qual o √°lbum / artista de hoje?" aria-label="Buscar" required>
                <button type="submit">Buscar</button>
            </form>
        </div>

        <div id="resultados" class="search-results"></div>

        <div id="mensagemCentral" class="search-center-message">
            <svg class="search-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p>bem vindo ao <span class="highlight-text">eko</span></p>
        </div>

        <div id="buscasPopulares" class="popular-searches">
            <h2>voc√™ tamb√©m pode gostar...</h2>
            <ul class="popular-list">
                <li><a href="#" onclick="testeBusca('Frank Ocean')">Frank Ocean (Artista)</a></li>
                <li><a href="#" onclick="testeBusca('Short n Sweet')">Short n' Sweet (√Ålbum)</a></li>
                <li><a href="#" onclick="testeBusca('Pink Floyd')">Pink Floyd (Artista)</a></li>
                <li><a href="#" onclick="testeBusca('Thriller')">Thriller (√Ålbum)</a></li>
            </ul>
        </div>
    </div>

    <script>
        function testeBusca(termo) {
            console.log('üß™ Teste de busca:', termo);
            document.getElementById('searchInput').value = termo;
            // Dispara o evento de submit manualmente
            document.getElementById('buscaForm').dispatchEvent(new Event('submit'));
        }

        document.getElementById('buscaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const termoInput = document.getElementById('searchInput').value;
            console.log('üîç Buscando por:', termoInput);
            
            const resultadosDiv = document.getElementById('resultados');
            resultadosDiv.innerHTML = '<p style="text-align: center; color: #B0B0B0; margin-top:20px;">Pesquisando no Spotify¬Æ...</p>';
            
            // Esconde interface inicial
            document.getElementById('mensagemCentral').style.display = 'none';
            document.getElementById('buscasPopulares').style.display = 'none';
            
            const formData = new FormData();
            formData.append('query', termoInput);
            
            fetch('/api/buscar_album', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                mostrarResultados(data);
            })
            .catch(error => {
                console.error('üí• Erro:', error);
                resultadosDiv.innerHTML = '<p class="error-message">Erro na comunica√ß√£o com o servidor.</p>';
                document.getElementById('mensagemCentral').style.display = 'block';
            });
        });

        function mostrarResultados(data) {
            const resultadosDiv = document.getElementById('resultados');
            
            if (data.erro) {
                resultadosDiv.innerHTML = `<p class="error-message">${data.erro}</p>`;
                return;
            }
            
            if (!Array.isArray(data) || data.length === 0) {
                resultadosDiv.innerHTML = '<p style="text-align: center; color: #B0B0B0; margin-top: 2rem;">Nenhum √°lbum encontrado para essa busca.</p>';
                return;
            }
            
            let html = '<h2 style="color: #FFFFFF; margin-bottom: 1rem; font-size: 1rem;">Resultados encontrados:</h2>';
            
            data.forEach(album => {
                const urlAvaliacao = `/avaliacao/${album.id}`;
                
                // Card clic√°vel inteiro
                html += `
                    <a href="${urlAvaliacao}" style="text-decoration: none; color: inherit; display: block;">
                        <div class="album-result">
                            ${album.imagem 
                                ? `<img src="${album.imagem}" alt="${album.nome}">` 
                                : '<div style="width: 80px; height: 80px; background: #333; border-radius: 8px; display:flex; align-items:center; justify-content:center;">üéµ</div>'}
                            
                            <div class="album-info">
                                <h3>${album.nome}</h3>
                                <p><strong>Artista:</strong> ${album.artista}</p>
                                <p style="font-size: 0.8rem; opacity: 0.7;">${album.data_lancamento || ''} ‚Ä¢ ${album.total_musicas} faixas</p>
                            </div>
                        </div>
                    </a>
                `;
            });
            
            resultadosDiv.innerHTML = html;
        }
    </script>
</body>
</html>