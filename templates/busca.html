<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca de M칰sica</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1E1E1E;
            color: #FFFFFF;
            padding: 1.5rem;
            min-height: 100vh;
        }

        .search-page-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 2rem;
        }

        .back-arrow {
            font-size: 1.5rem;
            color: #FFFFFF;
            text-decoration: none;
            line-height: 1;
            display: inline-block;
        }

        .search-bar {
            margin-bottom: 2rem;
        }

        .search-bar form {
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            background-color: #2F2F2F;
            color: #FFFFFF;
            font-size: 1rem;
        }

        .search-bar button {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            background-color: #F76B1C;
            color: #FFFFFF;
            font-size: 1rem;
            cursor: pointer;
        }

        .search-bar input::placeholder {
            color: #A0A0A0;
        }

        .search-bar input:focus {
            outline: none;
        }

        .search-center-message {
            text-align: center;
            margin-bottom: 2rem;
        }

        .search-icon {
            font-size: 4rem;
            color: #555555;
            display: block;
            margin-bottom: 0.5rem;
        }

        .search-center-message p {
            color: #B0B0B0;
        }

        .search-center-message .highlight-text {
            color: #F76B1C;
            text-decoration: none;
        }

        .popular-searches h2 {
            font-size: 0.9rem;
            font-weight: 500;
            color: #FFFFFF;
            margin-bottom: 1rem;
            text-transform: lowercase;
        }

        .popular-list {
            list-style: none;
            padding: 0;
        }

        .popular-list li {
            margin-bottom: 0.5rem;
        }

        .popular-list a {
            display: block;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            background-color: #2F2F2F;
            color: #FFFFFF;
            text-decoration: none;
            font-size: 1rem;
            transition: background-color 0.2s ease;
        }

        .popular-list a:hover {
            background-color: #3A3A3A;
        }

        .search-results {
            margin-top: 2rem;
        }

        /* Adicionei cursor pointer para indicar que o card 칠 clic치vel */
        .album-result {
            background-color: #2F2F2F;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.2s; /* Efeito visual opcional */
        }
        
        .album-result:hover {
            transform: scale(1.01); /* Leve zoom ao passar o mouse */
            background-color: #3A3A3A;
        }

        .album-result img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }

        .album-info {
            flex: 1;
        }

        .album-info h3 {
            color: #FFFFFF;
            margin-bottom: 0.5rem;
        }

        .album-info p {
            color: #B0B0B0;
            margin-bottom: 0.25rem;
        }

        .spotify-link {
            color: #1DB954;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .error-message {
            color: #ff4444;
            text-align: center;
            padding: 1rem;
            background-color: #2F2F2F;
            border-radius: 12px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <div class="search-page-container">
        <header>
            <a href="/" class="back-arrow">&larr;</a>
        </header>

        <div class="search-bar">
            <form id="buscaForm">
                <input type="text" id="albumInput" name="album" placeholder="qual o ritmo de hoje?" aria-label="Buscar 치lbum" required>
                <button type="submit">Buscar</button>
            </form>
        </div>

        <div id="resultados" class="search-results"></div>

        <div id="mensagemCentral" class="search-center-message">
            <svg class="search-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p>bem vindo ao <span class="highlight-text">eko</span></p>
        </div>

        <div id="buscasPopulares" class="popular-searches">
            <h2>치lbuns populares</h2>
            
            <ul class="popular-list">
                <li>
                    <a href="#" onclick="testeBusca('Back in Black')">Back in Black - AC/DC</a>
                </li>
                <li>
                    <a href="#" onclick="testeBusca('Short n Sweet')">Short n' Sweet - Sabrina Carpenter</a>
                </li>
                <li>
                    <a href="#" onclick="testeBusca('Blonde')">Blonde - Frank Ocean</a>
                </li>
                <li>
                    <a href="#" onclick="testeBusca('Off the Wall')">Off the Wall - Michael Jackson</a>
                </li>
            </ul>
        </div>
    </div>

    <script>
        function testeBusca(album) {
            console.log('游빍 Executando teste de busca:', album);
            document.getElementById('albumInput').value = album;
            document.getElementById('buscaForm').dispatchEvent(new Event('submit'));
        }

        document.getElementById('buscaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const albumInput = document.getElementById('albumInput').value;
            console.log('游댌 Buscando 치lbum:', albumInput);
            
            document.getElementById('resultados').innerHTML = '<p style="text-align: center; color: #B0B0B0;">Buscando...</p>';
            
            document.getElementById('mensagemCentral').style.display = 'none';
            document.getElementById('buscasPopulares').style.display = 'none';
            
            const formData = new FormData();
            formData.append('album', albumInput);
            
            fetch('/api/buscar_album', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('游니 Status da resposta:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('游늵 Dados recebidos:', data);
                mostrarResultados(data);
            })
            .catch(error => {
                console.error('游눤 Erro na busca:', error);
                document.getElementById('resultados').innerHTML = '<p class="error-message">Erro na busca: ' + error + '</p>';
                
                document.getElementById('mensagemCentral').style.display = 'block';
                document.getElementById('buscasPopulares').style.display = 'block';
            });
        });

        function mostrarResultados(data) {
            const resultadosDiv = document.getElementById('resultados');
            
            if (data.erro) {
                resultadosDiv.innerHTML = '<p class="error-message">Erro: ' + data.erro + '</p>';
                document.getElementById('mensagemCentral').style.display = 'block';
                document.getElementById('buscasPopulares').style.display = 'block';
                return;
            }
            
            if (!Array.isArray(data)) {
                resultadosDiv.innerHTML = '<p class="error-message">Formato de resposta inv치lido</p>';
                document.getElementById('mensagemCentral').style.display = 'block';
                document.getElementById('buscasPopulares').style.display = 'block';
                return;
            }
            
            if (data.length === 0) {
                resultadosDiv.innerHTML = '<p style="text-align: center; color: #B0B0B0;">Nenhum 치lbum encontrado.</p>';
                document.getElementById('mensagemCentral').style.display = 'block';
                document.getElementById('buscasPopulares').style.display = 'block';
                return;
            }
            
            let html = '<h2 style="color: #FFFFFF; margin-bottom: 1rem;">Resultados:</h2>';
            data.forEach(album => {
                // modifiquei aqui: criamos a URL com o ID e envolvemos o card em um <a> pra funcionar direito a nevega칞칚o
                const urlAvaliacao = `/avaliacao/${album.id}`;
                
                html += `
                    <a href="${urlAvaliacao}" style="text-decoration: none; color: inherit; display: block;">
                        <div class="album-result">
                            ${album.imagem ? `<img src="${album.imagem}" alt="${album.nome}">` : '<div style="width: 80px; height: 80px; background: #555; border-radius: 8px;"></div>'}
                            <div class="album-info">
                                <h3>${album.nome}</h3>
                                <p><strong>Artista:</strong> ${album.artista}</p>
                                <p><strong>Lan칞amento:</strong> ${album.data_lancamento}</p>
                                <p><strong>M칰sicas:</strong> ${album.total_musicas}</p>
                                <a href="${album.link_spotify}" target="_blank" class="spotify-link" onclick="event.stopPropagation()">游꿧 Abrir no Spotify</a>
                            </div>
                        </div>
                    </a>
                `;
            });
            
            resultadosDiv.innerHTML = html;
        }
    </script>
</body>
</html>