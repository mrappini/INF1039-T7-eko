<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca - Eko</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1E1E1E;
            color: #FFFFFF;
            padding: 1.5rem;
            min-height: 100vh;
        }
        .search-page-container { width: 100%; max-width: 600px; margin: 0 auto; }
        header { margin-bottom: 2rem; }
        .back-arrow { font-size: 1.5rem; color: #FFFFFF; text-decoration: none; line-height: 1; display: inline-block; }
        
        .search-bar { margin-bottom: 2rem; }
        .search-bar form { display: flex; gap: 10px; }
        .search-bar input {
            flex: 1; padding: 1rem 1.5rem; border: none; border-radius: 12px;
            background-color: #2F2F2F; color: #FFFFFF; font-size: 1rem;
        }
        .search-bar button {
            padding: 1rem 1.5rem; border: none; border-radius: 12px;
            background-color: #F76B1C; color: #FFFFFF; font-size: 1rem; cursor: pointer;
        }
        .search-bar input::placeholder { color: #A0A0A0; }
        .search-bar input:focus { outline: none; }

        .search-center-message { text-align: center; margin-bottom: 2rem; }
        .search-icon { font-size: 4rem; color: #555555; display: block; margin: 0 auto 0.5rem auto; }
        .search-center-message p { color: #B0B0B0; }
        .search-center-message .highlight-text { color: #F76B1C; }

        .popular-searches h2 { font-size: 0.9rem; font-weight: 500; color: #FFFFFF; margin-bottom: 1rem; text-transform: lowercase; }
        .popular-list { list-style: none; padding: 0; }
        .popular-list li { margin-bottom: 0.5rem; }
        .popular-list a {
            display: block; padding: 1rem 1.5rem; border-radius: 12px;
            background-color: #2F2F2F; color: #FFFFFF; text-decoration: none;
            font-size: 1rem; transition: background-color 0.2s ease;
        }
        .popular-list a:hover { background-color: #3A3A3A; }

        .search-results { margin-top: 2rem; }
        
        /* --- ESTILOS DO CARD E BOT√ÉO SPOTIFY --- */
        .album-result {
            background-color: #2F2F2F; 
            border-radius: 12px; 
            margin-bottom: 1rem; 
            display: flex; 
            align-items: center; 
            transition: transform 0.2s;
            /* Importante: padding zero aqui para os filhos controlarem o espa√ßo */
            padding: 0; 
            position: relative;
            overflow: hidden;
        }
        .album-result:hover { transform: scale(1.01); background-color: #3A3A3A; }

        /* Link principal (Capa + Texto) */
        .album-link-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1; /* Ocupa todo o espa√ßo sobrando */
            padding: 1rem;
            text-decoration: none;
            color: inherit;
        }

        .album-result img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }
        .album-info { flex: 1; }
        .album-info h3 { color: #FFFFFF; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .album-info p { color: #B0B0B0; margin-bottom: 0.25rem; font-size: 0.9rem; }
        
        .error-message { color: #ff4444; text-align: center; padding: 1rem; background-color: #2F2F2F; border-radius: 12px; margin-top: 1rem; }

        /* Bot√£o do Spotify (Direita) */
        .spotify-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            border: 1px solid #1DB954; /* Borda verde */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 15px; /* Espa√ßo da borda direita */
            color: #1DB954;
            transition: all 0.2s ease;
            flex-shrink: 0;
            z-index: 2;
            cursor: pointer;
        }

        .spotify-btn:hover {
            background-color: #1DB954;
            color: #FFFFFF;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(29, 185, 84, 0.4);
        }
    </style>
</head>
<body>

    <div class="search-page-container">
        <header>
            <a href="/" class="back-arrow">&larr;</a>
        </header>

        <div class="search-bar">
            <form id="buscaForm">
                <input type="text" id="searchInput" name="query" placeholder="qual o √°lbum / artista de hoje?" aria-label="Buscar" required>
                <button type="submit">Buscar</button>
            </form>
        </div>

        <div id="resultados" class="search-results"></div>

        <div id="mensagemCentral" class="search-center-message">
            <svg class="search-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <p>bem vindo ao <span class="highlight-text">eko</span></p>
        </div>

        <div id="buscasPopulares" class="popular-searches">
            <h2>voc√™ tamb√©m pode gostar...</h2>
            <ul class="popular-list">
                <li><a href="#" onclick="testeBusca('Frank Ocean')">Frank Ocean (Artista)</a></li>
                <li><a href="#" onclick="testeBusca('Short n Sweet')">Short n' Sweet (√Ålbum)</a></li>
                <li><a href="#" onclick="testeBusca('Pink Floyd')">Pink Floyd (Artista)</a></li>
                <li><a href="#" onclick="testeBusca('Thriller')">Thriller (√Ålbum)</a></li>
            </ul>
        </div>
    </div>

    <script>
        function testeBusca(termo) {
            console.log('üß™ Teste de busca:', termo);
            document.getElementById('searchInput').value = termo;
            document.getElementById('buscaForm').dispatchEvent(new Event('submit'));
        }

        document.getElementById('buscaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const termoInput = document.getElementById('searchInput').value;
            console.log('üîç Buscando por:', termoInput);
            
            const resultadosDiv = document.getElementById('resultados');
            resultadosDiv.innerHTML = '<p style="text-align: center; color: #B0B0B0; margin-top:20px;">Pesquisando no Spotify¬Æ...</p>';
            
            document.getElementById('mensagemCentral').style.display = 'none';
            document.getElementById('buscasPopulares').style.display = 'none';
            
            const formData = new FormData();
            formData.append('query', termoInput);
            
            fetch('/api/buscar_album', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                mostrarResultados(data);
            })
            .catch(error => {
                console.error('üí• Erro:', error);
                resultadosDiv.innerHTML = '<p class="error-message">Erro na comunica√ß√£o com o servidor.</p>';
                document.getElementById('mensagemCentral').style.display = 'block';
            });
        });

        function mostrarResultados(data) {
            const resultadosDiv = document.getElementById('resultados');
            
            if (data.erro) {
                resultadosDiv.innerHTML = `<p class="error-message">${data.erro}</p>`;
                return;
            }
            
            if (!Array.isArray(data) || data.length === 0) {
                resultadosDiv.innerHTML = '<p style="text-align: center; color: #B0B0B0; margin-top: 2rem;">Nenhum √°lbum encontrado para essa busca.</p>';
                return;
            }
            
            let html = '<h2 style="color: #FFFFFF; margin-bottom: 1rem; font-size: 1rem;">Resultados encontrados:</h2>';
            
            data.forEach(album => {
                const urlAvaliacao = `/avaliacao/${album.id}`;
                const urlSpotify = album.link_spotify || '#'; 
                
                html += `
                    <div class="album-result">
                        <a href="${urlAvaliacao}" class="album-link-wrapper">
                            ${album.imagem 
                                ? `<img src="${album.imagem}" alt="${album.nome}">` 
                                : '<div style="width: 80px; height: 80px; background: #333; border-radius: 8px; display:flex; align-items:center; justify-content:center;">üéµ</div>'}
                            
                            <div class="album-info">
                                <h3>${album.nome}</h3>
                                <p><strong>Artista:</strong> ${album.artista}</p>
                                <p style="font-size: 0.8rem; opacity: 0.7;">${album.data_lancamento || ''} ‚Ä¢ ${album.total_musicas} faixas</p>
                            </div>
                        </a>

                        <a href="${urlSpotify}" target="_blank" class="spotify-btn" title="Ouvir no Spotify">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2ZM16.56 16.68C16.293 17.11 15.73 17.243 15.3 16.977C12.78 15.437 9.60001 15.08 5.63001 15.99C5.14001 16.1 4.65001 15.79 4.54001 15.3C4.43001 14.81 4.74001 14.32 5.23001 14.21C9.65001 13.2 13.21 13.62 16.08 15.38C16.52 15.65 16.65 16.22 16.38 16.65L16.56 16.68ZM17.89 13.53C17.57 14.05 16.89 14.21 16.37 13.89C13.38 12.05 8.87001 11.52 5.32001 12.6C4.75001 12.77 4.15001 12.45 3.98001 11.88C3.81001 11.31 4.13001 10.71 4.70001 10.54C8.84001 9.28001 13.9 9.89001 17.46 12.08C17.98 12.4 18.14 13.08 17.82 13.6L17.89 13.53ZM18.01 10.27C14.37 8.11001 8.35001 7.91001 4.87001 8.97001C4.31001 9.14001 3.73001 8.82001 3.56001 8.26001C3.39001 7.70001 3.71001 7.12001 4.27001 6.95001C8.35001 5.71001 15.03 5.94001 19.23 8.43001C19.72 8.72001 19.88 9.35001 19.59 9.84001C19.3 10.33 18.67 10.49 18.18 10.2L18.01 10.27Z"/>
                            </svg>
                        </a>
                    </div>
                `;
            });
            
            resultadosDiv.innerHTML = html;
        }
    </script>
</body>
</html>